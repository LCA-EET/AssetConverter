using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace AssetConverter
{
    public static class StringIdentifier
    {
        public static string NAME = "NAME";
        public static string NAME2 = "NAME2";
        public static string INITIAL_MEETING = "INITIAL_MEETING";
        public static string MORALE = "MORALE";
        public static string HAPPY = "HAPPY";
        public static string UNHAPPY_ANNOYED = "UNHAPPY_ANNOYED";
        public static string UNHAPPY_SERIOUS = "UNHAPPY_SERIOUS";
        public static string UNHAPPY_BREAKING_POINT = "UNHAPPY_BREAKING_POINT";
        public static string LEADER = "LEADER";
        public static string TIRED = "TIRED";
        public static string BORED = "BORED";
        public static string BATTLE_CRY1 = "BATTLE_CRY1";
        public static string BATTLE_CRY2 = "BATTLE_CRY2";
        public static string BATTLE_CRY3 = "BATTLE_CRY3";
        public static string BATTLE_CRY4 = "BATTLE_CRY4";
        public static string BATTLE_CRY5 = "BATTLE_CRY5";
        public static string ATTACK1 = "ATTACK1";
        public static string ATTACK2 = "ATTACK2";
        public static string ATTACK3 = "ATTACK3";
        public static string ATTACK4 = "ATTACK4";
        public static string DAMAGE = "DAMAGE";
        public static string DYING = "DYING";
        public static string HURT = "HURT";
        public static string AREA_FOREST = "AREA_FOREST";
        public static string AREA_CITY = "AREA_CITY";
        public static string AREA_DUNGEON = "AREA_DUNGEON";
        public static string AREA_DAY = "AREA_DAY";
        public static string AREA_NIGHT = "AREA_NIGHT";
        public static string SELECT_COMMON1 = "SELECT_COMMON1";
        public static string SELECT_COMMON2 = "SELECT_COMMON2";
        public static string SELECT_COMMON3 = "SELECT_COMMON3";
        public static string SELECT_COMMON4 = "SELECT_COMMON4";
        public static string SELECT_COMMON5 = "SELECT_COMMON5";
        public static string SELECT_COMMON6 = "SELECT_COMMON6";
        public static string SELECT_ACTION1 = "SELECT_ACTION1";
        public static string SELECT_ACTION2 = "SELECT_ACTION2";
        public static string SELECT_ACTION3 = "SELECT_ACTION3";
        public static string SELECT_ACTION4 = "SELECT_ACTION4";
        public static string SELECT_ACTION5 = "SELECT_ACTION5";
        public static string SELECT_ACTION6 = "SELECT_ACTION6";
        public static string SELECT_ACTION7 = "SELECT_ACTION7";
        public static string INTERACTION1 = "INTERACTION1";
        public static string INTERACTION2 = "INTERACTION2";
        public static string INTERACTION3 = "INTERACTION3";
        public static string INTERACTION4 = "INTERACTION4";
        public static string INTERACTION5 = "INTERACTION5";
        public static string INSULT1 = "INSULT1";
        public static string INSULT2 = "INSULT2";
        public static string INSULT3 = "INSULT3";
        public static string COMPLIMENT1 = "COMPLIMENT1";
        public static string COMPLIMENT2 = "COMPLIMENT2";
        public static string COMPLIMENT3 = "COMPLIMENT3";
        public static string SPECIAL1 = "SPECIAL1";
        public static string SPECIAL2 = "SPECIAL2";
        public static string SPECIAL3 = "SPECIAL3";
        public static string REACT_TO_DIE_GENERAL = "REACT_TO_DIE_GENERAL";
        public static string REACT_TO_DIE_SPECIFIC = "REACT_TO_DIE_SPECIFIC";
        public static string RESPONSE_TO_COMPLIMENT1 = "RESPONSE_TO_COMPLIMENT1";
        public static string RESPONSE_TO_COMPLIMENT2 = "RESPONSE_TO_COMPLIMENT2";
        public static string RESPONSE_TO_COMPLIMENT3 = "RESPONSE_TO_COMPLIMENT3";
        public static string RESPONSE_TO_INSULT1 = "RESPONSE_TO_INSULT1";
        public static string RESPONSE_TO_INSULT2 = "RESPONSE_TO_INSULT2";
        public static string RESPONSE_TO_INSULT3 = "RESPONSE_TO_INSULT3";
        public static string DIALOG_HOSTILE = "DIALOG_HOSTILE";
        public static string DIALOG_DEFAULT = "DIALOG_DEFAULT";
        public static string SELECT_RARE1 = "SELECT_RARE1";
        public static string SELECT_RARE2 = "SELECT_RARE2";
        public static string CRITICAL_HIT = "CRITICAL_HIT";
        public static string CRITICAL_MISS = "CRITICAL_MISS";
        public static string TARGET_IMMUNE = "TARGET_IMMUNE";
        public static string INVENTORY_FULL = "INVENTORY_FULL";
        public static string PICKED_POCKET = "PICKED_POCKET";
        public static string HIDDEN_IN_SHADOWS = "HIDDEN_IN_SHADOWS";
        public static string SPELL_DISRUPTED = "SPELL_DISRUPTED";
        public static string SET_A_TRAP = "SET_A_TRAP";
        public static string EXISTANCE4 = "EXISTANCE4";
        public static string BIO = "BIO";
        public static string BG2EE_SELECT_RARE1 = "BG2EE_SELECT_RARE1";
        public static string BG2EE_SELECT_RARE2 = "BG2EE_SELECT_RARE2";
        public static string BG2EE_SELECT_RARE3 = "BG2EE_SELECT_RARE3";
        public static string BG2EE_SELECT_RARE4 = "BG2EE_SELECT_RARE4";
        public static string BGEE_ACTION4 = "BGEE_ACTION4";
        public static string BGEE_ACTION5 = "BGEE_ACTION5";
        public static string BGEE_ACTION6 = "BGEE_ACTION6";
        public static string BGEE_ACTION7 = "BGEE_ACTION7";
        public static string IWDEE_MORALE2 = "IWDEE_MORALE2";
        public static string IWDEE_LEADER2 = "IWDEE_LEADER2";
        public static string IWDEE_TIRED2 = "IWDEE_TIRED2";
        public static string IWDEE_BORED2 = "IWDEE_BORED2";
        public static string IWDEE_HURT2 = "IWDEE_HURT2";
        public static string IWDEE_SELECT_COMMON7 = "IWDEE_SELECT_COMMON7";
        public static string IWDEE_DAMAGE2 = "IWDEE_DAMAGE2";
        public static string IWDEE_DAMAGE3 = "IWDEE_DAMAGE3";
        public static string IWDEE_DYING2 = "IWDEE_DYING2";
        public static string IWDEE_REACT_TO_DIE_GENERAL2 = "IWDEE_REACT_TO_DIE_GENERAL2";

        public static string[] Identifiers = new string[]{
            NAME,
            NAME,
            NAME2,
            INITIAL_MEETING,
            MORALE,
            HAPPY,
            UNHAPPY_ANNOYED,
            UNHAPPY_SERIOUS,
            UNHAPPY_BREAKING_POINT,
            LEADER,
            TIRED,
            BORED,
            BATTLE_CRY1,
            BATTLE_CRY2,
            BATTLE_CRY3,
            BATTLE_CRY4,
            BATTLE_CRY5,
            ATTACK1,
            ATTACK2,
            ATTACK3,
            ATTACK4,
            DAMAGE,
            DYING,
            HURT,
            AREA_FOREST,
            AREA_CITY,
            AREA_DUNGEON,
            AREA_DAY,
            AREA_NIGHT,
            SELECT_COMMON1,
            SELECT_COMMON2,
            SELECT_COMMON3,
            SELECT_COMMON4,
            SELECT_COMMON5,
            SELECT_COMMON6,
            SELECT_ACTION1,
            SELECT_ACTION2,
            SELECT_ACTION3,
            SELECT_ACTION4,
            SELECT_ACTION5,
            SELECT_ACTION6,
            SELECT_ACTION7,
            INTERACTION1,
            INTERACTION2,
            INTERACTION3,
            INTERACTION4,
            INTERACTION5,
            INSULT1,
            INSULT2,
            INSULT3,
            COMPLIMENT1,
            COMPLIMENT2,
            COMPLIMENT3,
            SPECIAL1,
            SPECIAL2,
            SPECIAL3,
            REACT_TO_DIE_GENERAL,
            REACT_TO_DIE_SPECIFIC,
            RESPONSE_TO_COMPLIMENT1,
            RESPONSE_TO_COMPLIMENT2,
            RESPONSE_TO_COMPLIMENT3,
            RESPONSE_TO_INSULT1,
            RESPONSE_TO_INSULT2,
            RESPONSE_TO_INSULT3,
            DIALOG_HOSTILE,
            DIALOG_DEFAULT,
            SELECT_RARE1,
            SELECT_RARE2,
            CRITICAL_HIT,
            CRITICAL_MISS,
            TARGET_IMMUNE,
            INVENTORY_FULL,
            PICKED_POCKET,
            HIDDEN_IN_SHADOWS,
            SPELL_DISRUPTED,
            SET_A_TRAP,
            EXISTANCE4,
            BIO,
            BG2EE_SELECT_RARE1,
            BG2EE_SELECT_RARE2,
            BG2EE_SELECT_RARE3,
            BG2EE_SELECT_RARE4,
            BGEE_ACTION4,
            BGEE_ACTION5,
            BGEE_ACTION6,
            BGEE_ACTION7,
            IWDEE_MORALE2,
            IWDEE_LEADER2,
            IWDEE_TIRED2,
            IWDEE_BORED2,
            IWDEE_HURT2,
            IWDEE_SELECT_COMMON7,
            IWDEE_DAMAGE2,
            IWDEE_DAMAGE3,
            IWDEE_DYING2,
            IWDEE_REACT_TO_DIE_GENERAL2};
    }
    public class StringReference
    {
        private string _identifier;
        private string _text;
        public StringReference(string identifier, string text)
        {
            _identifier = identifier;
            _text = text;
        }

        public string Identifier
        {
            get
            {
                return _identifier;
            }
        }

        public string Text
        {
            get
            {
                return _text;
            }
        }
    }
    public class CRE : IEAsset
    {
        private Dictionary<int, StringReference> _stringReferences;
        public CRE(string preConversionPath, string postConversionPath, IEResRef resRef) : base(preConversionPath, postConversionPath, resRef)
        {
            _stringReferences = new Dictionary<int, StringReference>();
        }
        private void ReplaceReference(ref byte[] inBytes, byte[] replacement)
        {
            for(int i = 0; i < replacement.Length; i++)
            {
                inBytes[i] = replacement[i];
            }
        }
        private uint GetReference(ref byte[] inBytes, int index)
        {
            return BitConverter.ToUInt32(inBytes, index);
        }
        private void UpdateStringReferences()
        {
            byte[] inBytes = File.ReadAllBytes(_postConversionPath);
            int offSet = 8;
            string[] identifiers = StringIdentifier.Identifiers;
            _stringReferences.Add(offSet, new StringReference(identifiers[0], Program.MasterTRA.GetString(GetReference(ref inBytes, offSet))));
            offSet += 4;
            _stringReferences.Add(offSet, new StringReference(identifiers[1], Program.MasterTRA.GetString(GetReference(ref inBytes, offSet))));
            offSet = 164;
            for (int i = 2; i < identifiers.Length; i++)
            {
                _stringReferences.Add(offSet, new StringReference(identifiers[i], Program.MasterTRA.GetString(GetReference(ref inBytes, offSet))));
                offSet += 4;
            }
            //byte[] toWrite = ReferenceUpdater.UpdateComponentReferences(inBytes);
            //File.WriteAllBytes(_postConversionPath, toWrite);
        }
    }
}
